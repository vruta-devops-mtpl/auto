import{r,j as e,az as me,aA as ce,as as k,aB as T,n as de,aC as ue,aD as pe,B as v,aE as he,x as ge,aF as M,aG as be,a3 as xe,aq as fe,ar as b,ax as q}from"./index-cd518a67.js";import{u as je}from"./useThemeClass-a68676b2.js";import{D as _e}from"./SvgIcon-36bfcfad.js";import{u as ve,S as Me,C as ye}from"./search-5380743c.js";import"./Views-bb2b2b8f.js";import{u as Te}from"./usePosition-226cea48.js";import{c as Ce,a as y,F as Se,d as we,e as E}from"./index.esm-ae318cd2.js";const Le=({setValue:o})=>{const[h,C]=r.useState(""),S=u=>{const x=/^[0-9\b]+$/;(u.target.value===""||x.test(u.target.value))&&u.target.value!=="0"&&(C(u.target.value),o(u.target.value))};return e.jsxs(me,{children:[e.jsx(ce,{children:"+255"}),e.jsx(k,{value:h,onChange:S})]})};async function Ne(o){return T.request({url:"/user/user",method:"post",data:o})}async function De(o){return T.request({url:"/user/user"+o,method:"get"})}async function Fe(){return T.request({url:"/user/user/line-manager-drop-down",method:"get"})}async function Ae(o){return T.request({url:`/user/user/${o}`,method:"get"})}async function qe(o,h){return T.request({url:`/user/user/${h}`,method:"put",data:o})}async function ke(o){return T.request({url:`/user/user/${o}`,method:"delete"})}function Pe(){const[o,h]=r.useState([]),[C,S]=r.useState([]),[u,x]=r.useState(),[P,f]=r.useState(!1),[d,p]=r.useState(!1),[I,j]=r.useState(!1);return{fetchTeamMemberList:async m=>{try{f(!0);const l=await De(m);l.status===200&&h(l.data.data??[]),f(!1)}catch{f(!1)}},teamMemberList:o,loader:P,createTeamMemberApi:async m=>{try{if((await Ne(m)).status===201)return{status:"success",message:"Team Member Created Successfully"}}catch{return{status:"failed",message:"Something Went Wrong"}}},fetchTeamMemberDetails:async m=>{try{p(!0);const l=await Ae(m);l.status===200&&x(l.data.data),p(!1)}catch{p(!1)}},teamMemberDetails:u,setTeamMemberDetails:x,detailsLoader:d,updateTeamMemberApi:async(m,l)=>{try{if((await qe(m,l)).status===200)return{status:"success",message:"Team Member Updated Successfully"}}catch{return{status:"failed",message:"Something Went Wrong"}}},deleteTeamMemberApi:async m=>{try{j(!0);const l=await ke(m);if(j(!1),l.status===200)return{status:"success",message:"TeamMember deleted successfully"}}catch{return j(!1),{status:"failed",message:"Something Went Wrong"}}},isDeleting:I,teamMemberLineManager:C,fetchTeamMemberLineManager:async()=>{try{const m=await Fe();m.status===200&&S(m.data.data??[])}catch{}}}}const Be=()=>{const{textTheme:o}=je(),{fetchTeamMemberList:h,createTeamMemberApi:C,fetchTeamMemberDetails:S,updateTeamMemberApi:u,loader:x,detailsLoader:P,teamMemberList:f,teamMemberDetails:d,setTeamMemberDetails:p,deleteTeamMemberApi:I,isDeleting:j,teamMemberLineManager:O,fetchTeamMemberLineManager:$}=Pe(),{fetchPositionList:W,positionList:z,fetchPositionDropDown:K,positionDropDown:B}=Te(),{fetchTeamList:m,teamList:l}=ve(),[w,Q]=r.useState(1),[R,X]=r.useState(10),[Y,H]=r.useState(!1),[Z,G]=r.useState(!1),[V,_]=r.useState(!1),[L,N]=r.useState(""),[U,ee]=r.useState(""),[n,g]=r.useState({applyFilter:!1,positions:"",teams:"",line_manager:"",status:""}),{t:J}=de(),ae=Ce().shape({first_name:y().required("first name is required").trim(),last_name:y().required("Last name is required").trim(),phone_no:y().required("phone number is required").trim(),position_id:y().required("Position is required").trim(),line_manager:y().required("Line manager is required").trim(),email:y().email(`${J("email.isEmail")}`).required(`${J("email.isNotEmpty")}`).trim()}),se=r.useMemo(()=>[{header:"Team Member Name",accessorKey:"search_name",cell:a=>{var s,t;return e.jsx("div",{children:((t=(s=a==null?void 0:a.row)==null?void 0:s.original)==null?void 0:t.search_name)??"-"})}},{header:"Position",accessorKey:"position",enableSorting:!1,cell:a=>{var s,t;return e.jsx("div",{children:((t=(s=a==null?void 0:a.row)==null?void 0:s.original)==null?void 0:t.position)??"-"})}},{header:"Team",accessorKey:"team",enableSorting:!1,cell:a=>{var s,t;return e.jsx("div",{children:((t=(s=a==null?void 0:a.row)==null?void 0:s.original)==null?void 0:t.team)??"-"})}},{header:"Link Manager(s)",accessorKey:"linkManager",enableSorting:!1,cell:a=>{var s,t;return e.jsx("div",{children:((t=(s=a==null?void 0:a.row)==null?void 0:s.original)==null?void 0:t.linkManager)??"-"})}},{header:"Phone No.",accessorKey:"phone_no",enableSorting:!1,cell:a=>{var s,t;return e.jsx("div",{children:((t=(s=a==null?void 0:a.row)==null?void 0:s.original)==null?void 0:t.phone_no)??"-"})}},{header:"Status",accessorKey:"status",enableSorting:!1,cell:a=>e.jsx(e.Fragment,{children:e.jsx("div",{children:a.row.original.is_active?"Active":"Inactive"})})},{header:"Actions",accessorKey:"",cell:a=>e.jsxs("div",{className:"flex text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${o}`,onClick:()=>{N(a.row.original.id),S(a.row.original.id),_(!0)},children:e.jsx(ue,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>{N(a.row.original.id),G(!0)},children:e.jsx(pe,{})})]})}],[]),te=a=>{Q(a)},ne=(a=0)=>{X(Number(a))},re=()=>{H(!0)},ie=()=>{oe(L)},D=()=>{H(!1)},F=()=>{N(""),G(!1)},A=async()=>{var s,t,i,c;const a=`?search=${U}`;(s=n==null?void 0:n.positions)==null||s.value,(t=n==null?void 0:n.line_manager)==null||t.value,(i=n==null?void 0:n.status)==null||i.value,(c=n==null?void 0:n.teams)==null||c.value,h(a).then(()=>{g({...n,applyFilter:!1})})},le=async(a,s)=>{s(!0),console.log(a);const t={first_name:a.first_name,last_name:a.last_name,email:a.email,phone_no:a.phone_no,position_id:a.position_id,position_name:"",team_id:"",team_name:"",line_manger_id:"",line_manager_name:""},i=L===""?await C(t):await u(t,L);s(!1),(i==null?void 0:i.status)==="success"?(A(),_(!1),i!=null&&i.message&&q(i.message),p(null)):i!=null&&i.message&&q(i.message,"danger")},oe=async a=>{const s=await I(a);(s==null?void 0:s.status)==="success"?(A(),F(),s!=null&&s.message&&q(s.message)):s!=null&&s.message&&q(s.message,"danger")};return r.useEffect(()=>{$(),W(""),m(""),K()},[]),r.useEffect(()=>{A()},[R,w,U]),r.useEffect(()=>{n.applyFilter&&A(),console.log("filter === ",n)},[n]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center bg-danger w-full mb-5 ,t-3",children:[e.jsx(Me,{onInputChange:a=>{ee(a)}}),e.jsxs("div",{className:"flex",children:[e.jsx(v,{onClick:()=>re(),block:!0,variant:"default",size:"sm",className:"me-5",children:"Advance Filter"}),e.jsx(v,{onClick:()=>{N(""),_(!0)},block:!0,variant:"solid",size:"sm",icon:e.jsx(he,{}),children:"Add Team Member"})]})]}),e.jsxs(ge,{title:"Advance Filter",isOpen:Y,placement:"right",onClose:D,onRequestClose:D,footer:e.jsxs("div",{className:"flex justify-between	 text-right w-full",children:[e.jsx(v,{variant:"plain",size:"sm",className:"mr-2",onClick:()=>{D(),g({positions:"",teams:"",line_manager:"",status:"",applyFilter:!0})},children:"Clear Filter"}),e.jsx(v,{size:"sm",variant:"solid",onClick:()=>{D(),g({...n,applyFilter:!0})},children:"Submit"})]}),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"font-bold",htmlFor:"",children:"Positions"}),e.jsx(M,{placeholder:"Select",options:z.map(a=>({label:a.name,value:a.id})),value:n.positions,onChange:a=>{g({...n,positions:a})}})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"font-bold",htmlFor:"",children:"Teams"}),e.jsx(M,{placeholder:"Select",options:l.map(a=>({label:a.name,value:a.id})),value:n.teams,onChange:a=>{g({...n,teams:a})}})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"font-bold",htmlFor:"",children:"Line Manager"}),e.jsx(M,{placeholder:"Select",options:O.map(a=>({label:a.full_name,value:a.id})),value:n.line_manager,onChange:a=>{g({...n,line_manager:a})}})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"font-bold",htmlFor:"",children:"Status"}),e.jsx(M,{placeholder:"Select",options:[{label:"Active",value:"true"},{label:"Inactive",value:"false"}],value:n.status,onChange:a=>{g({...n,status:a})}})]})]}),e.jsx(_e,{columns:se,data:f,loading:x,onPaginationChange:te,onSelectChange:ne,module:"Team Members",pagingData:{total:f.length,pageIndex:w,pageSize:R}}),e.jsx(ye,{isOpen:Z,type:"danger",title:"Delete Team Member",confirmButtonColor:"red-600",onClose:F,onRequestClose:F,onCancel:F,onConfirm:ie,confirmText:j?"Please Wait":"Confirm",disabled:j,children:e.jsx("p",{children:"Are you sure you want to delete this member? All record related to this member will be deleted as well. This action cannot be undone."})}),e.jsx("div",{children:e.jsxs(be,{className:"p-0",isOpen:V,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,onClose:()=>{_(!1),p(null)},onRequestClose:()=>{_(!1),p(null)},children:[e.jsxs("h5",{className:"mb-4",children:[L===""?"Add":"Edit"," Team Member"]}),P?e.jsx(e.Fragment,{children:e.jsx(xe,{loading:!0,type:"cover"})}):e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsx(Se,{initialValues:{first_name:(d==null?void 0:d.first_name)??"",last_name:(d==null?void 0:d.last_name)??"",phone_no:(d==null?void 0:d.phone_no)??"",email:"",position_id:"",line_manager:""},validationSchema:ae,onSubmit:(a,{setSubmitting:s,setFieldError:t})=>{le(a,s)},children:({touched:a,errors:s,setFieldValue:t,isSubmitting:i})=>e.jsx(we,{children:e.jsxs(fe,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsx(b,{label:"First Name",invalid:s.first_name&&a.first_name,errorMessage:s.first_name,asterisk:!0,children:e.jsx(E,{type:"text",autoComplete:"off",name:"first_name",placeholder:"Type here...",component:k})}),e.jsx(b,{label:"Last Name",invalid:s.last_name&&a.last_name,asterisk:!0,errorMessage:s.last_name,children:e.jsx(E,{type:"text",autoComplete:"off",name:"last_name",placeholder:"Type here...",component:k})})]}),e.jsx(b,{label:"Phone",invalid:s.phone_no&&a.phone_no,asterisk:!0,errorMessage:s.phone_no,children:e.jsx(Le,{setValue:c=>{t("phone_no",c)}})}),e.jsx(b,{label:"Email",invalid:s.email&&a.email,asterisk:!0,errorMessage:s.email,children:e.jsx(E,{type:"text",autoComplete:"off",name:"email",placeholder:"Type here...",component:k})}),e.jsx(b,{label:"Position",invalid:s.position_id&&a.position_id,errorMessage:s.position_id,asterisk:!0,children:e.jsx(M,{placeholder:"Select (Options grouped by Teams)",options:B.map(c=>({label:c.position_name,value:c.position_id})),onChange:c=>{t("position_id",c.value),t("position_name",c.label)}})}),e.jsx(b,{label:"Line Manager(s)",invalid:s.line_manager&&a.line_manager,asterisk:!0,errorMessage:s.line_manager,children:e.jsx(M,{placeholder:"Select",options:O.map(c=>({label:c.line_manager_name,value:c.line_manger_id})),onChange:c=>{t("line_manager",c.value)}})}),e.jsxs(b,{className:"text-right mb-0",children:[e.jsx(v,{type:"reset",className:"ltr:mr-3 rtl:ml-3",onClick:()=>{_(!1),p(null)},children:"Cancel"}),e.jsx(v,{loading:i,variant:"solid",type:"submit",children:i?"Please Wait":"Submit"})]})]})})})})})]})})]})};export{Be as default};
